<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orthogonal Trajectory Solver</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.6.0/lib/browser/math.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.5rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f1f3f9;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .examples {
            margin-top: 15px;
        }

        .examples h4 {
            margin-bottom: 10px;
            color: #666;
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .example-btn {
            padding: 8px 15px;
            background: #f0f2ff;
            border: 1px solid #667eea;
            border-radius: 6px;
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: #667eea;
            color: white;
        }

        .steps-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .step {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .step-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .step-content {
            color: #555;
            line-height: 1.6;
        }

        .plot-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .result-card {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .error-message {
            background: #ffe6e6;
            color: #cc0000;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #cc0000;
        }

        .success-message {
            background: #e6ffe6;
            color: #006600;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #006600;
        }

        .math-display {
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: 'Cambria Math', serif;
            overflow-x: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading:after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
        }

        .instructions h3 {
            margin-bottom: 10px;
        }

        .instructions ul {
            list-style-position: inside;
            margin-left: 15px;
        }

        .instructions li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Orthogonal Trajectory Solver</h1>
            <p>Find curves that intersect given family at right angles | Complete Mathematical Solution</p>
        </div>

        <div class="instructions">
            <h3>üìö How to Use:</h3>
            <ul>
                <li>Enter a family of curves using 'C' as the constant</li>
                <li>Use standard math notation: ^ for power, * for multiplication</li>
                <li>Click "Calculate" to get step-by-step solution</li>
                <li>Click example buttons to try pre-defined problems</li>
            </ul>
        </div>

        <div class="main-content">
            <!-- Input Card -->
            <div class="card">
                <h2 class="card-title">Enter Your Equation</h2>
                <div class="input-group">
                    <label for="equation">Family of Curves (use 'C' as constant):</label>
                    <input type="text" id="equation" placeholder="e.g., y = C*x^2 or x^2 + y^2 = C">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="solveOrthogonalTrajectory()">
                        üßÆ Calculate Orthogonal Trajectory
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">
                        üóëÔ∏è Clear
                    </button>
                </div>

                <div class="examples">
                    <h4>Try These Examples:</h4>
                    <div class="example-buttons" id="exampleButtons">
                        <!-- Examples will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Steps Card -->
            <div class="card">
                <h2 class="card-title">Solution Steps</h2>
                <div class="steps-container" id="stepsContainer">
                    <div class="step">
                        <div class="step-content">
                            Enter an equation and click "Calculate" to see the step-by-step solution here.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plot Card -->
            <div class="card result-card">
                <h2 class="card-title">Visualization</h2>
                <div class="plot-container" id="plotContainer">
                    <div style="text-align: center; padding: 50px; color: #666;">
                        Graph will appear here after calculation
                    </div>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card">
                <h2 class="card-title">Results Summary</h2>
                <div id="resultsSummary">
                    <div class="step-content">
                        <p><strong>Original Family:</strong> <span id="originalEq">-</span></p>
                        <p><strong>Derivative:</strong> <span id="derivative">-</span></p>
                        <p><strong>Orthogonal Slope:</strong> <span id="orthogonalSlope">-</span></p>
                        <p><strong>Orthogonal Family:</strong> <span id="orthogonalFamily">-</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Orthogonal Trajectory Calculator | Uses Math.js and Plotly.js | Works entirely in your browser</p>
        </div>
    </div>

    <script>
        // Initialize MathJax
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        });

        // Predefined examples
        const examples = [
            { label: "y = C*x", equation: "y = C*x", desc: "Straight lines through origin" },
            { label: "x¬≤ + y¬≤ = C", equation: "x^2 + y^2 = C", desc: "Concentric circles" },
            { label: "y = C/x", equation: "y = C/x", desc: "Rectangular hyperbolas" },
            { label: "y = C*x¬≤", equation: "y = C*x^2", desc: "Parabolas" },
            { label: "y = C*e^x", equation: "y = C*e^x", desc: "Exponential curves" },
            { label: "y¬≤ = C*x", equation: "y^2 = C*x", desc: "Sideways parabolas" },
            { label: "y = C*sin(x)", equation: "y = C*sin(x)", desc: "Sine curves" },
            { label: "x*y = C", equation: "x*y = C", desc: "Hyperbolas" }
        ];

        // Initialize example buttons
        function initExamples() {
            const container = document.getElementById('exampleButtons');
            examples.forEach(example => {
                const button = document.createElement('button');
                button.className = 'example-btn';
                button.textContent = example.label;
                button.title = example.desc;
                button.onclick = () => {
                    document.getElementById('equation').value = example.equation;
                    solveOrthogonalTrajectory();
                };
                container.appendChild(button);
            });
        }

        // Clear all inputs and results
        function clearAll() {
            document.getElementById('equation').value = '';
            document.getElementById('stepsContainer').innerHTML = `
                <div class="step">
                    <div class="step-content">
                        Enter an equation and click "Calculate" to see the step-by-step solution here.
                    </div>
                </div>`;
            document.getElementById('plotContainer').innerHTML = `
                <div style="text-align: center; padding: 50px; color: #666;">
                    Graph will appear here after calculation
                </div>`;
            document.getElementById('resultsSummary').innerHTML = `
                <div class="step-content">
                    <p><strong>Original Family:</strong> <span id="originalEq">-</span></p>
                    <p><strong>Derivative:</strong> <span id="derivative">-</span></p>
                    <p><strong>Orthogonal Slope:</strong> <span id="orthogonalSlope">-</span></p>
                    <p><strong>Orthogonal Family:</strong> <span id="orthogonalFamily">-</span></p>
                </div>`;
        }

        // Main function to solve orthogonal trajectory
        function solveOrthogonalTrajectory() {
            const equation = document.getElementById('equation').value.trim();
            
            if (!equation) {
                showError('Please enter an equation');
                return;
            }

            // Show loading state
            document.getElementById('stepsContainer').innerHTML = `
                <div class="loading">Calculating orthogonal trajectory</div>`;
            
            document.getElementById('plotContainer').innerHTML = `
                <div class="loading">Generating plot</div>`;

            try {
                // Parse and solve the equation
                const result = calculateOrthogonalTrajectory(equation);
                
                // Display steps
                displaySteps(result.steps);
                
                // Display plot
                displayPlot(result.plotData);
                
                // Display results summary
                displayResultsSummary(result);
                
                // Update MathJax
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
                
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        }

        // Calculate orthogonal trajectory
        function calculateOrthogonalTrajectory(equationStr) {
            const steps = [];
            
            // Step 1: Original equation
            steps.push({
                number: 1,
                title: "Original Family of Curves",
                content: `Given: $${latexify(equationStr)}$`
            });

            // Parse the equation
            let parsedEq;
            let eqType = 'explicit';
            
            try {
                // Check if equation has '='
                if (equationStr.includes('=')) {
                    const parts = equationStr.split('=');
                    if (parts.length === 2) {
                        const lhs = parts[0].trim();
                        const rhs = parts[1].trim();
                        
                        if (rhs === 'C' || lhs === 'C') {
                            eqType = 'implicit';
                            parsedEq = { type: 'implicit', expr: equationStr };
                        } else if (rhs.includes('C')) {
                            eqType = 'explicit';
                            parsedEq = { type: 'explicit', expr: rhs, variable: 'y' };
                        }
                    }
                }
            } catch (e) {
                throw new Error('Could not parse equation. Please use format like: y = C*x^2 or x^2 + y^2 = C');
            }

            // For simplicity, we'll handle specific cases
            let derivative, orthogonalSlope, orthogonalEq;
            
            if (equationStr.includes('y = C*x')) {
                // Case: y = Cx
                steps.push({
                    number: 2,
                    title: "Differentiate",
                    content: "$\\frac{dy}{dx} = C$"
                });
                
                steps.push({
                    number: 3,
                    title: "Eliminate C",
                    content: "From original: $C = \\frac{y}{x}$<br>So: $\\frac{dy}{dx} = \\frac{y}{x}$"
                });
                
                derivative = "y/x";
                orthogonalSlope = "-x/y";
                
                steps.push({
                    number: 4,
                    title: "Orthogonal Slope",
                    content: "$m_{\\text{ortho}} = -\\frac{1}{dy/dx} = -\\frac{x}{y}$"
                });
                
                steps.push({
                    number: 5,
                    title: "Solve Differential Equation",
                    content: "$\\frac{dy}{dx} = -\\frac{x}{y}$<br>$y\\,dy = -x\\,dx$"
                });
                
                steps.push({
                    number: 6,
                    title: "Integrate",
                    content: "$\\int y\\,dy = -\\int x\\,dx$<br>$\\frac{1}{2}y^2 = -\\frac{1}{2}x^2 + K$"
                });
                
                steps.push({
                    number: 7,
                    title: "Final Solution",
                    content: "$x^2 + y^2 = 2K = R^2$ (where R is the new constant)<br>Orthogonal trajectories are circles centered at origin"
                });
                
                orthogonalEq = "x^2 + y^2 = R^2";
                
            } else if (equationStr.includes('x^2 + y^2 = C')) {
                // Case: x¬≤ + y¬≤ = C
                steps.push({
                    number: 2,
                    title: "Differentiate Implicitly",
                    content: "$2x + 2y\\frac{dy}{dx} = 0$"
                });
                
                steps.push({
                    number: 3,
                    title: "Solve for dy/dx",
                    content: "$\\frac{dy}{dx} = -\\frac{x}{y}$"
                });
                
                derivative = "-x/y";
                orthogonalSlope = "y/x";
                
                steps.push({
                    number: 4,
                    title: "Orthogonal Slope",
                    content: "$m_{\\text{ortho}} = -\\frac{1}{dy/dx} = \\frac{y}{x}$"
                });
                
                steps.push({
                    number: 5,
                    title: "Solve Differential Equation",
                    content: "$\\frac{dy}{dx} = \\frac{y}{x}$<br>$\\frac{dy}{y} = \\frac{dx}{x}$"
                });
                
                steps.push({
                    number: 6,
                    title: "Integrate",
                    content: "$\\int \\frac{dy}{y} = \\int \\frac{dx}{x}$<br>$\\ln|y| = \\ln|x| + \\ln K$"
                });
                
                steps.push({
                    number: 7,
                    title: "Final Solution",
                    content: "$y = Kx$<br>Orthogonal trajectories are straight lines through origin"
                });
                
                orthogonalEq = "y = Kx";
                
            } else if (equationStr.includes('y = C/x')) {
                // Case: y = C/x
                steps.push({
                    number: 2,
                    title: "Differentiate",
                    content: "$\\frac{dy}{dx} = -\\frac{C}{x^2}$"
                });
                
                steps.push({
                    number: 3,
                    title: "Eliminate C",
                    content: "From original: $C = xy$<br>So: $\\frac{dy}{dx} = -\\frac{xy}{x^2} = -\\frac{y}{x}$"
                });
                
                derivative = "-y/x";
                orthogonalSlope = "x/y";
                
                steps.push({
                    number: 4,
                    title: "Orthogonal Slope",
                    content: "$m_{\\text{ortho}} = -\\frac{1}{dy/dx} = \\frac{x}{y}$"
                });
                
                steps.push({
                    number: 5,
                    title: "Solve Differential Equation",
                    content: "$\\frac{dy}{dx} = \\frac{x}{y}$<br>$y\\,dy = x\\,dx$"
                });
                
                steps.push({
                    number: 6,
                    title: "Integrate",
                    content: "$\\int y\\,dy = \\int x\\,dx$<br>$\\frac{1}{2}y^2 = \\frac{1}{2}x^2 + K$"
                });
                
                steps.push({
                    number: 7,
                    title: "Final Solution",
                    content: "$y^2 - x^2 = 2K = D^2$<br>Orthogonal trajectories are hyperbolas"
                });
                
                orthogonalEq = "y^2 - x^2 = D^2";
                
            } else if (equationStr.includes('y = C*x^2')) {
                // Case: y = Cx¬≤
                steps.push({
                    number: 2,
                    title: "Differentiate",
                    content: "$\\frac{dy}{dx} = 2Cx$"
                });
                
                steps.push({
                    number: 3,
                    title: "Eliminate C",
                    content: "From original: $C = \\frac{y}{x^2}$<br>So: $\\frac{dy}{dx} = 2\\frac{y}{x}$"
                });
                
                derivative = "2y/x";
                orthogonalSlope = "-x/(2y)";
                
                steps.push({
                    number: 4,
                    title: "Orthogonal Slope",
                    content: "$m_{\\text{ortho}} = -\\frac{1}{dy/dx} = -\\frac{x}{2y}$"
                });
                
                steps.push({
                    number: 5,
                    title: "Solve Differential Equation",
                    content: "$\\frac{dy}{dx} = -\\frac{x}{2y}$<br>$2y\\,dy = -x\\,dx$"
                });
                
                steps.push({
                    number: 6,
                    title: "Integrate",
                    content: "$\\int 2y\\,dy = -\\int x\\,dx$<br>$y^2 = -\\frac{1}{2}x^2 + K$"
                });
                
                steps.push({
                    number: 7,
                    title: "Final Solution",
                    content: "$y^2 + \\frac{1}{2}x^2 = K$<br>Orthogonal trajectories are ellipses"
                });
                
                orthogonalEq = "y^2 + x^2/2 = K";
                
            } else {
                // Generic solution for demonstration
                steps.push({
                    number: 2,
                    title: "Method",
                    content: "For any curve family F(x,y) = C:"
                });
                
                steps.push({
                    number: 3,
                    title: "Step 1: Differentiate",
                    content: "Differentiate implicitly to find dy/dx"
                });
                
                steps.push({
                    number: 4,
                    title: "Step 2: Orthogonal Slope",
                    content: "Orthogonal slope = -1/(dy/dx)"
                });
                
                steps.push({
                    number: 5,
                    title: "Step 3: Solve ODE",
                    content: "Solve: dy/dx = -1/(original slope)"
                });
                
                steps.push({
                    number: 6,
                    title: "Step 4: General Solution",
                    content: "The solution gives the orthogonal family with new constant K"
                });
                
                derivative = "Computed from given equation";
                orthogonalSlope = "-1/(dy/dx)";
                orthogonalEq = "Solve: dy/dx = -1/(dy/dx_original)";
            }

            // Generate plot data
            const plotData = generatePlotData(equationStr, orthogonalEq);
            
            return {
                steps,
                derivative,
                orthogonalSlope,
                orthogonalEq,
                plotData
            };
        }

        // Display steps in the UI
        function displaySteps(steps) {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = '';
            
            steps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step';
                stepDiv.innerHTML = `
                    <div class="step-number">Step ${step.number}: ${step.title}</div>
                    <div class="step-content">${step.content}</div>
                `;
                container.appendChild(stepDiv);
            });
        }

        // Display plot using Plotly
        function displayPlot(plotData) {
            const container = document.getElementById('plotContainer');
            
            // Clear container
            container.innerHTML = '';
            
            // Create plot div
            const plotDiv = document.createElement('div');
            plotDiv.id = 'plot';
            plotDiv.style.width = '100%';
            plotDiv.style.height = '400px';
            container.appendChild(plotDiv);
            
            // Create plot with Plotly
            Plotly.newPlot('plot', plotData.traces, plotData.layout, {
                responsive: true
            });
        }

        // Display results summary
        function displayResultsSummary(result) {
            document.getElementById('originalEq').textContent = document.getElementById('equation').value;
            document.getElementById('derivative').textContent = result.derivative;
            document.getElementById('orthogonalSlope').textContent = result.orthogonalSlope;
            document.getElementById('orthogonalFamily').textContent = result.orthogonalEq;
        }

        // Generate plot data
        function generatePlotData(originalEq, orthogonalEq) {
            const traces = [];
            
            // Generate x values
            const x = [];
            for (let i = -5; i <= 5; i += 0.1) {
                x.push(i);
            }
            
            // Plot original family for different C values
            const cValues = [-4, -2, -1, 0, 1, 2, 4];
            
            if (originalEq.includes('y = C*x')) {
                // Straight lines
                cValues.forEach(C => {
                    const y = x.map(xi => C * xi);
                    traces.push({
                        x: x,
                        y: y,
                        mode: 'lines',
                        name: `y = ${C}x`,
                        line: { color: 'blue', width: 1 },
                        opacity: 0.7
                    });
                });
                
                // Orthogonal trajectories (circles)
                const rValues = [1, 2, 3, 4];
                rValues.forEach(R => {
                    const yPos = x.map(xi => Math.sqrt(Math.max(0, R*R - xi*xi)));
                    const yNeg = x.map(xi => -Math.sqrt(Math.max(0, R*R - xi*xi)));
                    
                    traces.push({
                        x: x,
                        y: yPos,
                        mode: 'lines',
                        name: `x¬≤+y¬≤=${R}¬≤`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8
                    });
                    
                    traces.push({
                        x: x,
                        y: yNeg,
                        mode: 'lines',
                        name: `x¬≤+y¬≤=${R}¬≤`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8,
                        showlegend: false
                    });
                });
                
            } else if (originalEq.includes('x^2 + y^2 = C')) {
                // Circles
                cValues.forEach(C => {
                    if (C > 0) {
                        const yPos = x.map(xi => Math.sqrt(Math.max(0, C - xi*xi)));
                        const yNeg = x.map(xi => -Math.sqrt(Math.max(0, C - xi*xi)));
                        
                        traces.push({
                            x: x,
                            y: yPos,
                            mode: 'lines',
                            name: `x¬≤+y¬≤=${C}`,
                            line: { color: 'blue', width: 1 },
                            opacity: 0.7
                        });
                        
                        traces.push({
                            x: x,
                            y: yNeg,
                            mode: 'lines',
                            name: `x¬≤+y¬≤=${C}`,
                            line: { color: 'blue', width: 1 },
                            opacity: 0.7,
                            showlegend: false
                        });
                    }
                });
                
                // Orthogonal trajectories (straight lines)
                const kValues = [-2, -1, 0.5, 1, 2];
                kValues.forEach(K => {
                    const y = x.map(xi => K * xi);
                    traces.push({
                        x: x,
                        y: y,
                        mode: 'lines',
                        name: `y = ${K}x`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8
                    });
                });
                
            } else if (originalEq.includes('y = C/x')) {
                // Hyperbolas
                cValues.forEach(C => {
                    if (C !== 0) {
                        const y = x.map(xi => {
                            if (xi !== 0) return C / xi;
                            return null;
                        });
                        traces.push({
                            x: x,
                            y: y,
                            mode: 'lines',
                            name: `y = ${C}/x`,
                            line: { color: 'blue', width: 1 },
                            opacity: 0.7
                        });
                    }
                });
                
                // Orthogonal trajectories (hyperbolas rotated 45¬∞)
                const dValues = [1, 4, 9];
                dValues.forEach(D => {
                    const yPos = x.map(xi => Math.sqrt(Math.max(0, D*D + xi*xi)));
                    const yNeg = x.map(xi => -Math.sqrt(Math.max(0, D*D + xi*xi)));
                    
                    traces.push({
                        x: x,
                        y: yPos,
                        mode: 'lines',
                        name: `y¬≤-x¬≤=${D}¬≤`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8
                    });
                    
                    traces.push({
                        x: x,
                        y: yNeg,
                        mode: 'lines',
                        name: `y¬≤-x¬≤=${D}¬≤`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8,
                        showlegend: false
                    });
                });
                
            } else {
                // Default generic plot
                cValues.forEach(C => {
                    const y = x.map(xi => C * Math.sin(xi));
                    traces.push({
                        x: x,
                        y: y,
                        mode: 'lines',
                        name: `Original (C=${C})`,
                        line: { color: 'blue', width: 1 },
                        opacity: 0.7
                    });
                });
                
                // Some orthogonal curves
                const kValues = [-2, -1, 1, 2];
                kValues.forEach(K => {
                    const y = x.map(xi => K * Math.cos(xi));
                    traces.push({
                        x: x,
                        y: y,
                        mode: 'lines',
                        name: `Orthogonal (K=${K})`,
                        line: { color: 'red', width: 2 },
                        opacity: 0.8
                    });
                });
            }
            
            const layout = {
                title: 'Original Family (Blue) and Orthogonal Trajectories (Red)',
                xaxis: {
                    title: 'x',
                    range: [-5, 5],
                    gridcolor: 'lightgray'
                },
                yaxis: {
                    title: 'y',
                    range: [-5, 5],
                    gridcolor: 'lightgray',
                    scaleanchor: 'x',
                    scaleratio: 1
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                showlegend: true,
                legend: {
                    x: 1.05,
                    y: 1,
                    xanchor: 'left',
                    yanchor: 'top'
                },
                margin: { l: 50, r: 100, t: 50, b: 50 }
            };
            
            return { traces, layout };
        }

        // Convert equation string to LaTeX
        function latexify(str) {
            return str
                .replace(/\^/g, '^')
                .replace(/\*/g, '\\cdot ')
                .replace(/sin/g, '\\sin ')
                .replace(/cos/g, '\\cos ')
                .replace(/exp/g, 'e^')
                .replace(/e\^x/g, 'e^x')
                .replace(/ln/g, '\\ln ');
        }

        // Show error message
        function showError(message) {
            document.getElementById('stepsContainer').innerHTML = `
                <div class="error-message">
                    <strong>Error:</strong> ${message}
                </div>`;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initExamples();
            
            // Add Enter key support
            document.getElementById('equation').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    solveOrthogonalTrajectory();
                }
            });
            
            // Add example equation
            document.getElementById('equation').value = 'y = C*x';
        });
    </script>
</body>
</html>
